<div class="note-header">
  <h1 class="note-title page-title">
    <%- partial('_partial/icon', {name: 'tags', size: 22}) %>
    <% if (page.tag) { %>
      #<%= page.tag %>
      <span class="page-title-count"><%= page.posts.length %> notes</span>
    <% } else { %>
      Tags
      <span class="page-title-count"><%= site.tags.length %></span>
    <% } %>
  </h1>
</div>

<% if (page.tag) { %>
  <!-- Single tag view: list posts -->
  <div class="post-list">
    <% page.posts.each(function(post) { %>
    <%- partial('_partial/post-item', { post: post }) %>
    <% }) %>
  </div>
  <%- partial('_partial/pagination') %>

<% } else { %>
  <!-- All tags view: tag cloud -->
  <%
    var allTags = site.tags.toArray().sort(function(a, b) {
      return b.posts.length - a.posts.length;
    });
    var maxCount = allTags.length > 0 ? allTags[0].posts.length : 1;
  %>
  <div class="tags-page-cloud">
    <% allTags.forEach(function(tag) { %>
    <%
      var weight = tag.posts.length / maxCount;
      var size = 0.8 + weight * 0.7; // 0.8em to 1.5em
      var opacity = 0.55 + weight * 0.45;
    %>
    <a href="<%- url_for(tag.path) %>" class="tag-pill tag-pill-weighted"
       style="font-size: <%= size.toFixed(2) %>em; opacity: <%= opacity.toFixed(2) %>;"
       title="<%= tag.posts.length %> notes">
      #<%= tag.name %>
      <span class="tag-count"><%= tag.posts.length %></span>
    </a>
    <% }) %>
  </div>
<% } %>
